<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WeirdGPT</title>
<style>
    body {
        margin: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #202123;
        color: #fff;
        display: flex;
        flex-direction: column;
        height: 100vh;
    }
    #chatContainer {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    .message {
        max-width: 70%;
        padding: 12px 16px;
        border-radius: 15px;
        line-height: 1.4;
        word-wrap: break-word;
        animation: fadeIn 0.2s ease-in-out;
    }
    .message.user {
        background-color: #4caf50;
        color: #fff;
        align-self: flex-end;
        border-bottom-right-radius: 0;
    }
    .message.bot {
        background-color: #3a3b3c;
        color: #fff;
        align-self: flex-start;
        border-bottom-left-radius: 0;
        white-space: pre-wrap;
    }
    #inputContainer {
        display: flex;
        padding: 10px;
        background-color: #2a2a2a;
    }
    #userInput {
        flex: 1;
        padding: 12px;
        border-radius: 25px;
        border: none;
        outline: none;
        font-size: 16px;
        background-color: #121212;
        color: #fff;
    }
    #sendBtn {
        padding: 12px 20px;
        margin-left: 10px;
        border: none;
        border-radius: 25px;
        background-color: #ff9500;
        color: #fff;
        font-weight: bold;
        cursor: pointer;
    }
    #sendBtn:hover {
        background-color: #ffaa33;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(5px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>
</head>
<body>
<div id="chatContainer"></div>

<div id="inputContainer">
    <input id="userInput" placeholder="Digite algo..." />
    <button id="sendBtn">Enviar</button>
</div>

<script>
const chatContainer = document.getElementById('chatContainer');
const userInput = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');

function appendMessage(sender, text) {
    const div = document.createElement('div');
    div.className = 'message ' + sender;
    div.textContent = text;
    chatContainer.appendChild(div);
    chatContainer.scrollTop = chatContainer.scrollHeight;
    return div;
}

async function sendMessage() {
    const text = userInput.value.trim();
    if (!text) return;
    appendMessage('user', text);
    userInput.value = '';

    const botMessageDiv = appendMessage('bot', '');
    let controller = new AbortController();

    try {
        const res = await fetch('https://weirdgpt-backend.onrender.com/stream', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: text }),
            signal: controller.signal
        });

        if (!res.body) throw new Error("Streaming nÃ£o suportado");

        const reader = res.body.getReader();
        const decoder = new TextDecoder();
        let done = false;

        while(!done) {
            const { value, done: readerDone } = await reader.read();
            if (value) {
                botMessageDiv.textContent += decoder.decode(value);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
            done = readerDone;
        }

    } catch(e) {
        botMessageDiv.textContent = 'fail to connect to backend';
    }
}

sendBtn.addEventListener('click', sendMessage);
userInput.addEventListener('keypress', (e) => {
    if(e.key === 'Enter') sendMessage();
});

// Mensagem inicial
appendMessage('bot', 'Ready.');
</script>
</body>
</html>
